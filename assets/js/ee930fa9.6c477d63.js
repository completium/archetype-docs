"use strict";(self.webpackChunkarchetype_docs=self.webpackChunkarchetype_docs||[]).push([[8517],{4048:function(e,t,a){var n=a(5318);t.Z=void 0;var i=n(a(4938)),r=a(5893),l=(0,i.default)((0,r.jsx)("path",{d:"M19 19H5V5h7V3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"}),"OpenInNew");t.Z=l},1519:function(e,t,a){a.d(t,{Z:function(){return f}});var n=a(3366),i=a(7462),r=a(7294),l=a(6010),o=a(7192),s=a(1796),d=a(2110),p=a(1539),c=a(8979);function m(e){return(0,c.Z)("MuiDivider",e)}(0,a(6087).Z)("MuiDivider",["root","absolute","fullWidth","inset","middle","flexItem","light","vertical","withChildren","withChildrenVertical","textAlignRight","textAlignLeft","wrapper","wrapperVertical"]);var u=a(5893);const k=["absolute","children","className","component","flexItem","light","orientation","role","textAlign","variant"],h=(0,d.ZP)("div",{name:"MuiDivider",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:a}=e;return[t.root,a.absolute&&t.absolute,t[a.variant],a.light&&t.light,"vertical"===a.orientation&&t.vertical,a.flexItem&&t.flexItem,a.children&&t.withChildren,a.children&&"vertical"===a.orientation&&t.withChildrenVertical,"right"===a.textAlign&&"vertical"!==a.orientation&&t.textAlignRight,"left"===a.textAlign&&"vertical"!==a.orientation&&t.textAlignLeft]}})((({theme:e,ownerState:t})=>(0,i.Z)({margin:0,flexShrink:0,borderWidth:0,borderStyle:"solid",borderColor:e.palette.divider,borderBottomWidth:"thin"},t.absolute&&{position:"absolute",bottom:0,left:0,width:"100%"},t.light&&{borderColor:(0,s.Fq)(e.palette.divider,.08)},"inset"===t.variant&&{marginLeft:72},"middle"===t.variant&&"horizontal"===t.orientation&&{marginLeft:e.spacing(2),marginRight:e.spacing(2)},"middle"===t.variant&&"vertical"===t.orientation&&{marginTop:e.spacing(1),marginBottom:e.spacing(1)},"vertical"===t.orientation&&{height:"100%",borderBottomWidth:0,borderRightWidth:"thin"},t.flexItem&&{alignSelf:"stretch",height:"auto"})),(({theme:e,ownerState:t})=>(0,i.Z)({},t.children&&{display:"flex",whiteSpace:"nowrap",textAlign:"center",border:0,"&::before, &::after":{position:"relative",width:"100%",borderTop:`thin solid ${e.palette.divider}`,top:"50%",content:'""',transform:"translateY(50%)"}})),(({theme:e,ownerState:t})=>(0,i.Z)({},t.children&&"vertical"===t.orientation&&{flexDirection:"column","&::before, &::after":{height:"100%",top:"0%",left:"50%",borderTop:0,borderLeft:`thin solid ${e.palette.divider}`,transform:"translateX(0%)"}})),(({ownerState:e})=>(0,i.Z)({},"right"===e.textAlign&&"vertical"!==e.orientation&&{"&::before":{width:"90%"},"&::after":{width:"10%"}},"left"===e.textAlign&&"vertical"!==e.orientation&&{"&::before":{width:"10%"},"&::after":{width:"90%"}}))),g=(0,d.ZP)("span",{name:"MuiDivider",slot:"Wrapper",overridesResolver:(e,t)=>{const{ownerState:a}=e;return[t.wrapper,"vertical"===a.orientation&&t.wrapperVertical]}})((({theme:e,ownerState:t})=>(0,i.Z)({display:"inline-block",paddingLeft:`calc(${e.spacing(1)} * 1.2)`,paddingRight:`calc(${e.spacing(1)} * 1.2)`},"vertical"===t.orientation&&{paddingTop:`calc(${e.spacing(1)} * 1.2)`,paddingBottom:`calc(${e.spacing(1)} * 1.2)`})));var f=r.forwardRef((function(e,t){const a=(0,p.Z)({props:e,name:"MuiDivider"}),{absolute:r=!1,children:s,className:d,component:c=(s?"div":"hr"),flexItem:f=!1,light:v=!1,orientation:N="horizontal",role:y=("hr"!==c?"separator":void 0),textAlign:w="center",variant:C="fullWidth"}=a,b=(0,n.Z)(a,k),E=(0,i.Z)({},a,{absolute:r,component:c,flexItem:f,light:v,orientation:N,role:y,textAlign:w,variant:C}),x=(e=>{const{absolute:t,children:a,classes:n,flexItem:i,light:r,orientation:l,textAlign:s,variant:d}=e,p={root:["root",t&&"absolute",d,r&&"light","vertical"===l&&"vertical",i&&"flexItem",a&&"withChildren",a&&"vertical"===l&&"withChildrenVertical","right"===s&&"vertical"!==l&&"textAlignRight","left"===s&&"vertical"!==l&&"textAlignLeft"],wrapper:["wrapper","vertical"===l&&"wrapperVertical"]};return(0,o.Z)(p,m,n)})(E);return(0,u.jsx)(h,(0,i.Z)({as:c,className:(0,l.Z)(x.root,d),role:y,ref:t,ownerState:E},b,{children:s?(0,u.jsx)(g,{className:x.wrapper,ownerState:E,children:s}):null}))}))},432:function(e,t,a){a.d(t,{Z:function(){return f}});var n=a(7855),i=a(9960),r=a(6886),l=a(1519),o=a(5861),s=a(4810),d=a(7294),p=a(2321),c=a(3465),m=[{label:"asset",link:"/docs/asset"},{label:"asset to big_map",link:"/docs/asset"},{label:"asset to iterable_big_map",link:"/docs/asset"},{label:"aggregate",link:"/docs/reference/types#aggregate<A>"},{label:"partition",link:"/docs/reference/types#partition<A>"},{label:"asset_view",link:"/docs/reference/types#asset_view<A>"}];function u(e){var t;return d.createElement(r.ZP,{item:!0,xs:12,style:{marginTop:"12px"}},d.createElement(r.ZP,{container:!0},d.createElement(r.ZP,{item:!0},d.createElement("h4",{style:(t={marginBottom:"0px",color:"grey",fontWeight:"normal"},t.marginBottom="12px",t)},"Type of collection ",d.createElement("code",null,"A"))),d.createElement(r.ZP,{item:!0,xs:12},d.createElement(l.Z,{className:p.Z.divider,style:{marginBottom:"12px"}})),d.createElement(r.ZP,{item:!0,xs:12},d.createElement(r.ZP,{container:!0,spacing:2},m.map((function(t,a){return d.createElement(r.ZP,{item:!0},d.createElement(i.Z,{to:t.link},d.createElement("code",{style:{textDecoration:e.data.includes(t.label)?"none":"line-through"}},t.label)))}))))))}var k=function(e){return d.createElement(r.ZP,{item:!0,xs:12},d.createElement(r.ZP,{container:!0},d.createElement(r.ZP,{item:!0,xs:12},d.createElement(l.Z,{className:p.Z.divider,style:{marginBottom:"12px"}})),d.createElement(r.ZP,{item:!0,md:e.xs,sm:6,xs:6},d.createElement(r.ZP,{container:!0},d.createElement(r.ZP,{item:!0,xs:e.xs>4?2:4},d.createElement(o.Z,null,d.createElement("code",null,e.alias)," :")),d.createElement(r.ZP,{item:!0,xs:e.xs>4?10:8},d.createElement(o.Z,null," ",void 0===e.withLink||e.withLink?d.createElement(i.Z,{to:"/docs/reference/types#"+e.type},d.createElement("code",null,e.type)):d.createElement("code",null,e.type))))),d.createElement(r.ZP,{item:!0,md:12-e.xs,sm:6,xs:6},d.createElement(o.Z,{style:{fontFamily:"IBM Plex Sans"}},e.desc))))},h=function(e){return d.createElement(r.ZP,{item:!0,xs:12},d.createElement(r.ZP,{container:!0},d.createElement(r.ZP,{item:!0,xs:12},d.createElement(l.Z,{className:p.Z.divider,style:{marginBottom:"12px"}})),d.createElement(r.ZP,{item:!0,xs:12,style:{marginBottom:"6px"}},d.createElement(o.Z,null,void 0===e.withLink||e.withLink?d.createElement(i.Z,{to:"/docs/reference/types#"+e.type},d.createElement("code",null,e.type)):d.createElement("code",null,e.type))),d.createElement(r.ZP,{item:!0,xs:10},d.createElement(o.Z,{style:{fontFamily:"IBM Plex Sans"}},e.desc))))},g=function(e){return function(e,t,a){for(var i,r=t,l=(0,n.Z)(a);!(i=l()).done;)r=e(r,i.value);return r}((function(e,t){return e>=t?e:t}),-1/0,e)};function f(e){var t,a,n=void 0!==e.data.parameters?(t=e.data.parameters,(a=g(t.map((function(e){return e.alias.length+e.type.length}))))>30?6:a>20?5:a>10?3:2):0;return d.createElement(s.Z,{injectFirst:!0},d.createElement(r.ZP,{container:!0,direction:"row",justifyContent:"flex-start",alignItems:"center",spacing:1,style:{marginBottom:"60px"}},d.createElement(r.ZP,{item:!0,xs:12},d.createElement(o.Z,{style:{fontFamily:"IBM Plex Sans"}},e.data.desc)),void 0!==e.data.appliesto?d.createElement(u,{data:e.data.appliesto}):d.createElement("div",null),void 0!==e.data.parameters&&e.data.parameters.length>0?d.createElement(r.ZP,{item:!0},d.createElement("h4",{style:{marginBottom:"0px",marginTop:"12px",color:"grey",fontWeight:"normal"}},e.data.parameters.length>1?"Parameters":"Parameter")):d.createElement("div",null),void 0!==e.data.parameters&&e.data.parameters.length>0?e.data.parameters.map((function(e,t){return d.createElement(k,{key:"bp"+t,alias:e.alias,type:e.type,desc:e.desc,xs:n,withLink:e.withLink})})):d.createElement("div",null),void 0!==e.data.returns?d.createElement(r.ZP,{item:!0,style:{marginTop:"12px",color:"grey"}},d.createElement("h4",{style:{marginTop:"12px",marginBottom:"0px",fontWeight:"normal"}},"Returns")):d.createElement(r.ZP,{item:!0,style:{marginTop:"12px",color:"grey"}},d.createElement("h4",{style:{marginTop:"12px",marginBottom:"0px",fontWeight:"normal"}})),void 0!==e.data.returns?d.createElement(h,{type:e.data.returns.type,withLink:e.data.returns.withLink,desc:e.data.returns.desc}):d.createElement("div",null),d.createElement(r.ZP,{item:!0,xs:12},d.createElement(c.Z,{fails:e.data.fails,michelson:e.data.michelson,michelson_ref_url:e.data.michelson_ref_url,related:e.data.related}))))}},3465:function(e,t,a){a.d(t,{Z:function(){return c}});var n=a(5861),i=a(6886),r=a(1519),l=a(7294),o=a(2321),s=a(8271),d=a(563),p=function(e){return void 0===e.fails||0===e.fails.length?l.createElement(n.Z,{style:{fontFamily:"IBM Plex Sans",color:"grey",fontStyle:"italic"}},"does not fail"):l.createElement(i.ZP,{container:!0},e.fails.map((function(t,a){return l.createElement(i.ZP,{container:!0,style:{marginBottom:e.fails.length>1?"22px":"0px"}},l.createElement(i.ZP,{key:"fk"+a,item:!0,xs:t.keyword.length>12?12:2,style:{marginBottom:t.keyword.length>12?"12px":"0px"}},l.createElement(n.Z,null,l.createElement("code",null,t.keyword))),l.createElement(i.ZP,{key:"fd"+a,item:!0,xs:t.keyword.length>12?12:10},l.createElement(n.Z,{style:{fontFamily:"IBM Plex Sans"}},t.desc)),a<e.fails.length-1?l.createElement(i.ZP,{item:!0,xs:12},l.createElement(r.Z,{className:o.Z.divider,style:{marginTop:"12px"}})):l.createElement("div",null))})))};function c(e){return l.createElement(i.ZP,{container:!0,direction:"row",justifyContent:"flex-start",alignItems:"center",spacing:1,style:{marginTop:"0px"}},l.createElement(i.ZP,{item:!0,xs:3,sm:2,md:2},l.createElement(n.Z,{style:{fontFamily:"IBM Plex Sans",color:"grey"}},"Fails with")),l.createElement(i.ZP,{item:!0,xs:9,sm:10,md:10},l.createElement(p,{fails:e.fails})),void 0!==e.michelson?l.createElement(i.ZP,{item:!0,xs:12},l.createElement(r.Z,{className:o.Z.divider})):l.createElement("div",null),void 0!==e.michelson?l.createElement(i.ZP,{item:!0,xs:3,sm:2,md:2},l.createElement(n.Z,{style:{fontFamily:"IBM Plex Sans",color:"grey"}},"Michelson")):l.createElement("div",null),void 0!==e.michelson?l.createElement(i.ZP,{item:!0,xs:9,sm:10,md:10},l.createElement(s.R,{michelson:e.michelson,michelson_ref_url:e.michelson_ref_url})):l.createElement("div",null),void 0!==e.related?l.createElement(i.ZP,{item:!0,xs:12},l.createElement(r.Z,{className:o.Z.divider})):l.createElement("div",null),void 0!==e.related?l.createElement(i.ZP,{item:!0,xs:3,sm:2,md:2},l.createElement(n.Z,{style:{fontFamily:"IBM Plex Sans",color:"grey"}},"Related")):l.createElement("div",null),void 0!==e.related?l.createElement(i.ZP,{item:!0,xs:9,sm:10,md:10},l.createElement(i.ZP,{container:!0,direction:"row",spacing:3},e.related.map((function(e,t){return l.createElement(d.n,{key:"rel"+t,value:e.keyword,link:e.link,code:e.code})})))):l.createElement("div",null))}},8271:function(e,t,a){a.d(t,{R:function(){return s}});var n=a(7294),i=a(6292),r=a(6886),l=a(9960),o=a(4048),s=function(e){return void 0===e.michelson_ref_url?"[object Array]"!==Object.prototype.toString.call(e.michelson)?n.createElement(i.Z,{style:{textTransform:"none",fontFamily:"Roboto Mono",color:"var(--ifm-color-primary)"},disableFocusRipple:!0,size:"small",disableRipple:!0},e.michelson):n.createElement(r.ZP,{container:!0,spacing:1},e.michelson.map((function(e,t){return n.createElement(r.ZP,{item:!0,key:"mt"+t},n.createElement(i.Z,{style:{textTransform:"none",fontFamily:"Roboto Mono",color:"var(--ifm-color-primary)"},disableFocusRipple:!0,size:"small",disableRipple:!0},e))}))):n.createElement(l.Z,{to:e.michelson_ref_url},n.createElement(i.Z,{style:{textTransform:"none",fontFamily:"Roboto Mono",color:"var(--ifm-color-primary)"},size:"small",disableRipple:!0,endIcon:n.createElement(o.Z,{fontSize:"small"})},e.michelson))}},563:function(e,t,a){a.d(t,{n:function(){return o}});var n=a(9960),i=a(6886),r=a(5861),l=a(7294),o=function(e){return l.createElement(i.ZP,{item:!0},l.createElement(n.Z,{to:e.link},l.createElement(r.Z,{style:{fontFamily:"IBM Plex Sans"}},null!=e.code&&!1===e.code?e.value:l.createElement("code",null,e.value))))}},8299:function(e,t,a){a.r(t),a.d(t,{assets:function(){return G},contentTitle:function(){return W},default:function(){return U},frontMatter:function(){return q},metadata:function(){return V},toc:function(){return j}});var n=a(7462),i=a(3366),r=a(7294),l=a(3905),o=a(9960),s=["components"],d={toc:[{value:"Partition",id:"partition",level:4},{value:"Aggregate",id:"aggregate",level:4}]};function p(e){var t=e.components,a=(0,i.Z)(e,s);return(0,l.kt)("wrapper",(0,n.Z)({},d,a,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("p",null,"Adds a new asset ",(0,l.kt)("inlineCode",{parentName:"p"},"a")," in collection ",(0,l.kt)("inlineCode",{parentName:"p"},"A"),". It fails when the key of asset ",(0,l.kt)("inlineCode",{parentName:"p"},"a")," is already contained in collection ",(0,l.kt)("inlineCode",{parentName:"p"},"A"),"."),(0,l.kt)("p",null,"For example, given the following asset declaration with 5 fields:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-archetype"},"asset loan {\n  id         : string;\n  subscriber : address;\n  principal  : tez;\n  interest   : rational = 2%;\n  time       : duration = 10w; /* 10 weeks */\n}\n")),(0,l.kt)("p",null,"The following instruction adds a new loan to the collection of loans:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-archetype"},'loan.add({\n  id         = "1a3245";\n  subscriber = tz1Lc2qBKEWCBeDU8npG6zCeCqpmaegRi6Jg;\n  interest   = 5%;\n  time       = 50w;\n})\n')),(0,l.kt)("p",null,"When all fields are specified, it is possible to omit fields label:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-archetype"},'loan.add({ "1a3245"; tz1Lc2qBKEWCBeDU8npG6zCeCqpmaegRi6Jg; 5%; 50w5d })\n')),(0,l.kt)("p",null,"Fields with default values (like ",(0,l.kt)("inlineCode",{parentName:"p"},"interest")," and ",(0,l.kt)("inlineCode",{parentName:"p"},"time"),") may be omitted in asset literal; other fields labels must then be present:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-archetype"},'loan.add({\n  id         = "1a3245";\n  subscriber = tz1Lc2qBKEWCBeDU8npG6zCeCqpmaegRi6Jg;\n})  /* interest and time are defaulted to 2% and 10 weeks respectively */\n')),(0,l.kt)("h4",{id:"partition"},"Partition"),(0,l.kt)("p",null,"A partitioned asset may be added only through the ",(0,l.kt)("a",{parentName:"p",href:"/docs/reference/types#partition%3CA%3E"},"partition")," field of the partitioning asset, that is that it is not possible to straighforwardly add an asset in a partitioned asset."),(0,l.kt)("p",null,"For example, consider the following declarations where a ",(0,l.kt)("inlineCode",{parentName:"p"},"mile")," belongs to one and only one ",(0,l.kt)("inlineCode",{parentName:"p"},"flyer")," through the ",(0,l.kt)("inlineCode",{parentName:"p"},"miles")," partition field:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-archetype"},"asset mile identified by k {\n  k          : string;\n  expiration : date\n}\n\nasset flyer identified by a {\n  a     : address;\n  miles : partition<mile>\n}\n")),(0,l.kt)("p",null,"The proper way to add the mile asset ",(0,l.kt)("inlineCode",{parentName:"p"},'{ "#1", now }')," is with the following instruction on the partition field of flyer ",(0,l.kt)("inlineCode",{parentName:"p"},"a"),":"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-archetype"},'flyer[a].miles.add({ "#1"; (now + 30d) })\n')),(0,l.kt)("p",null,"Note that the effect of above instruction is to:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"add the asset in the partitioned asset (so that ",(0,l.kt)("inlineCode",{parentName:"li"},'mile.contains("#1")')," returns ",(0,l.kt)("inlineCode",{parentName:"li"},"true"),")"),(0,l.kt)("li",{parentName:"ul"},"add the reference ",(0,l.kt)("inlineCode",{parentName:"li"},'"#1"')," to the partition field ",(0,l.kt)("inlineCode",{parentName:"li"},"assets")," (so that ",(0,l.kt)("inlineCode",{parentName:"li"},'flyer[a].miles.contains("#1")')," returns ",(0,l.kt)("inlineCode",{parentName:"li"},"true")," )")),(0,l.kt)("p",null,"The following instruction is ",(0,l.kt)("em",{parentName:"p"},"rejected")," by the compiler:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-archetype"},'mile.add({ "#1"; (now + 30d) })\n')),(0,l.kt)("p",null,"with the following error:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"Cannot access asset collection: asset partitioned is partitionned by field(s) (miles).\n")),(0,l.kt)("h4",{id:"aggregate"},"Aggregate"),(0,l.kt)("p",null,"The ",(0,l.kt)("inlineCode",{parentName:"p"},"add")," instruction on an ",(0,l.kt)("a",{parentName:"p",href:"/docs/reference/types#aggregate%3CA%3E"},"aggregate")," field only takes the key to the referenced asset."),(0,l.kt)("p",null,"For example, consider the following declarations where a ",(0,l.kt)("inlineCode",{parentName:"p"},"vehicle")," may be referenced by several ",(0,l.kt)("inlineCode",{parentName:"p"},"driver")," assets through the ",(0,l.kt)("inlineCode",{parentName:"p"},"drives")," aggregate field:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-archetype"},"asset vehicle identified by vin {\n  vin     : string;\n  nbdoors : nat\n}\n\nasset driver identified by id {\n  id     : address;\n  drives : aggregate<vehicle>\n}\n")),(0,l.kt)("p",null,"The following instruction adds the reference to vehicle ",(0,l.kt)("inlineCode",{parentName:"p"},'"1G1AF1F57A7192174"')," to driver ",(0,l.kt)("inlineCode",{parentName:"p"},"caller"),":"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-archetype"},'driver[caller].drives.add("1G1AF1F57A7192174");\n')),(0,l.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("p",{parentName:"div"},"The instruction above fails if vehicle ",(0,l.kt)("inlineCode",{parentName:"p"},'"1G1AF1F57A7192174"')," does not exist."))))}p.isMDXComponent=!0;var c=["components"],m={toc:[]};function u(e){var t=e.components,a=(0,i.Z)(e,c);return(0,l.kt)("wrapper",(0,n.Z)({},m,a,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("p",null,"Adds a new asset ",(0,l.kt)("inlineCode",{parentName:"p"},"a")," in collection ",(0,l.kt)("inlineCode",{parentName:"p"},"A"),", or replaces by asset ",(0,l.kt)("inlineCode",{parentName:"p"},"a")," the asset in collection ",(0,l.kt)("inlineCode",{parentName:"p"},"A")," with same key."),(0,l.kt)("p",null,"For example, given the following asset declaration with 5 fields:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-archetype"},"asset loan {\n  id         : string;\n  subscriber : address;\n  principal  : tez;\n  interest   : rational = 2%;\n  time       : duration = 10w; /* 10 weeks */\n}\n")),(0,l.kt)("p",null,"The following instruction adds or replaces asset ",(0,l.kt)("inlineCode",{parentName:"p"},'"1a3245"'),":"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-archetype"},'loan.put({\n  id         = "1a3245";\n  subscriber = tz1Lc2qBKEWCBeDU8npG6zCeCqpmaegRi6Jg;\n  interest   = 5%;\n  time       = 50w;\n})\n')),(0,l.kt)("p",null,"As for the ",(0,l.kt)("a",{parentName:"p",href:"/docs/reference/instructions/asset#aadda"},(0,l.kt)("inlineCode",{parentName:"a"},"add"))," instruction, fields label may be omitted when all fields are specified:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-archetype"},'loan.put({ "1a3245"; tz1Lc2qBKEWCBeDU8npG6zCeCqpmaegRi6Jg; 5%; 50w5d })\n')),(0,l.kt)("p",null,"Fields with default values (like interest and time) may be omitted in asset literal; other fields labels must then be present:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-archetype"},'loan.put({\n  id         = "1a3245";\n  subscriber = tz1Lc2qBKEWCBeDU8npG6zCeCqpmaegRi6Jg;\n})  /* interest and time are defaulted to 2% and 10 weeks respectively */\n')))}u.isMDXComponent=!0;var k=["components"],h={toc:[{value:"Basic containers",id:"basic-containers",level:4},{value:"Partition",id:"partition",level:4},{value:"Aggregate",id:"aggregate",level:4}]};function g(e){var t=e.components,a=(0,i.Z)(e,k);return(0,l.kt)("wrapper",(0,n.Z)({},h,a,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("p",null,"Adds a new asset or updates asset with key ",(0,l.kt)("inlineCode",{parentName:"p"},"k")," in collection ",(0,l.kt)("inlineCode",{parentName:"p"},"A")," (does ",(0,l.kt)("em",{parentName:"p"},"not")," fail):"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"it adds a new asset if asset ",(0,l.kt)("inlineCode",{parentName:"li"},"k")," is not in ",(0,l.kt)("inlineCode",{parentName:"li"},"A")),(0,l.kt)("li",{parentName:"ul"},"it updates asset ",(0,l.kt)("inlineCode",{parentName:"li"},"k")," is in ",(0,l.kt)("inlineCode",{parentName:"li"},"A"))),(0,l.kt)("p",null,"For example, consider the ",(0,l.kt)("inlineCode",{parentName:"p"},"ledger")," asset:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-archetype"},"asset ledger identified by holder to big_map {\n  holder     : address;\n  tokens     : nat = 0;\n}\n")),(0,l.kt)("p",null,"Consider the following ",(0,l.kt)("em",{parentName:"p"},"add_update")," instruction:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-archetype"},"ledger.add_update(%to, { tokens += value });\n")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"if ",(0,l.kt)("inlineCode",{parentName:"li"},"%to")," holder is not in the ",(0,l.kt)("inlineCode",{parentName:"li"},"ledger")," collection, this adds asset ",(0,l.kt)("inlineCode",{parentName:"li"},"{ %to; value\xa0}")," to it"),(0,l.kt)("li",{parentName:"ul"},"if ",(0,l.kt)("inlineCode",{parentName:"li"},"%to")," is in ",(0,l.kt)("inlineCode",{parentName:"li"},"ledger")," collection, this increments the ",(0,l.kt)("inlineCode",{parentName:"li"},"tokens")," field by ",(0,l.kt)("inlineCode",{parentName:"li"},"value"))),(0,l.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("p",{parentName:"div"},"Note that it is possible to use the ",(0,l.kt)("inlineCode",{parentName:"p"},"+=")," assignment instruction on field ",(0,l.kt)("inlineCode",{parentName:"p"},"tokens")," because ",(0,l.kt)("inlineCode",{parentName:"p"},"tokens")," has a ",(0,l.kt)("em",{parentName:"p"},"default value")," specified (",(0,l.kt)("inlineCode",{parentName:"p"},"0"),") in asset declaration."))),(0,l.kt)("h4",{id:"basic-containers"},"Basic containers"),(0,l.kt)("p",null,(0,l.kt)("a",{parentName:"p",href:"/docs/language-basics/container#map"},"Maps")," and ",(0,l.kt)("a",{parentName:"p",href:"/docs/language-basics/container#set"},"sets")," fieds may be updated with ",(0,l.kt)("inlineCode",{parentName:"p"},":=")," ",(0,l.kt)("inlineCode",{parentName:"p"},"+=")," and ",(0,l.kt)("inlineCode",{parentName:"p"},"-=")," update instructions."),(0,l.kt)("p",null,"For example, consider the following asset declaration:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-archetype"},"asset my_asset {\n  id : nat;\n  m  : map<string, bytes>;\n}\n")),(0,l.kt)("p",null,"The following creates asset ",(0,l.kt)("inlineCode",{parentName:"p"},"0")," and associates 3 values to ",(0,l.kt)("inlineCode",{parentName:"p"},'"k"')," ",(0,l.kt)("inlineCode",{parentName:"p"},'"l"')," and ",(0,l.kt)("inlineCode",{parentName:"p"},'"m"')," keys in map field ",(0,l.kt)("inlineCode",{parentName:"p"},"m"),":"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-archetype"},'my_asset.add_update(0, { m += [("k", 0x00); ("l", 0x01); ("m", 0x02)] });\n')),(0,l.kt)("p",null,"The ",(0,l.kt)("inlineCode",{parentName:"p"},"+=")," instruction overwrites any previous association."),(0,l.kt)("p",null,"The following removes key ",(0,l.kt)("inlineCode",{parentName:"p"},'"k"')," in ",(0,l.kt)("inlineCode",{parentName:"p"},"m")," of asset ",(0,l.kt)("inlineCode",{parentName:"p"},"0"),":"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-archetype"},'my_asset.add_update(0, { m -= ["k"] });\n')),(0,l.kt)("h4",{id:"partition"},"Partition"),(0,l.kt)("p",null,"As for the ",(0,l.kt)("inlineCode",{parentName:"p"},"add")," instruction, the ",(0,l.kt)("inlineCode",{parentName:"p"},"add_update")," instruction is available for ",(0,l.kt)("a",{parentName:"p",href:"/docs/reference/types#partition%3CA%3E"},"partition")," field."),(0,l.kt)("p",null,"For example, the following instruction adds or updates the expiration date of mile ",(0,l.kt)("inlineCode",{parentName:"p"},'"#1"')," of flyer ",(0,l.kt)("inlineCode",{parentName:"p"},"caller"),":"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-archetype"},'flyer[caller].miles.add_update("#1", { expiration := (now + 40d) })\n')),(0,l.kt)("p",null,"See the ",(0,l.kt)("a",{parentName:"p",href:"/docs/reference/instructions/asset#partition"},"paritition")," section above for more information."),(0,l.kt)("h4",{id:"aggregate"},"Aggregate"),(0,l.kt)("p",null,"An ",(0,l.kt)("a",{parentName:"p",href:"/docs/reference/types#aggregate%3CA%3E"},"aggregate")," field does ",(0,l.kt)("em",{parentName:"p"},"not")," provide the ",(0,l.kt)("inlineCode",{parentName:"p"},"add_update")," instruction."))}g.isMDXComponent=!0;var f=["components"],v={toc:[{value:"Partition",id:"partition",level:4},{value:"Aggregate",id:"aggregate",level:4}]};function N(e){var t=e.components,a=(0,i.Z)(e,f);return(0,l.kt)("wrapper",(0,n.Z)({},v,a,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("p",null,"Removes elements from container ",(0,l.kt)("inlineCode",{parentName:"p"},"A"),", ",(0,l.kt)("inlineCode",{parentName:"p"},"A")," being an asset collection, an ",(0,l.kt)("a",{parentName:"p",href:"/docs/asset#aggregate"},"aggregate")," or a ",(0,l.kt)("a",{parentName:"p",href:"/docs/asset#partition"},"partition")," field."),(0,l.kt)("p",null,"For example, to remove all ",(0,l.kt)("a",{parentName:"p",href:"/docs/reference/instructions/asset#aadda"},(0,l.kt)("inlineCode",{parentName:"a"},"loan"))," assets:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-archetype"},"loan.remove_all();\n")),(0,l.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("p",{parentName:"div"},"As iteration is not available on big maps, ",(0,l.kt)("inlineCode",{parentName:"p"},"remove_all")," is not available for ",(0,l.kt)("inlineCode",{parentName:"p"},"asset to big_map")," type."))),(0,l.kt)("h4",{id:"partition"},"Partition"),(0,l.kt)("p",null,"The ",(0,l.kt)("inlineCode",{parentName:"p"},"remove_all")," instruction on a ",(0,l.kt)("a",{parentName:"p",href:"/docs/reference/types#partition%3CA%3E"},"partition")," field removes all references in the partition field ",(0,l.kt)("em",{parentName:"p"},"and")," also removes assets from the partiotioned asset collection."),(0,l.kt)("p",null,"For example, the following instruction removes all miles owned by ",(0,l.kt)("inlineCode",{parentName:"p"},"caller")," ",(0,l.kt)("a",{parentName:"p",href:"/docs/reference/instructions/asset#partition"},"flyer"),":"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-archetype"},"flyer[caller].miles.remove_all();\n")),(0,l.kt)("p",null,"The effect of above instruction is to:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"remove all miles from ",(0,l.kt)("inlineCode",{parentName:"li"},"mile")," collection owner by ",(0,l.kt)("inlineCode",{parentName:"li"},"caller")),(0,l.kt)("li",{parentName:"ul"},"remove all reference to these miles so that ",(0,l.kt)("inlineCode",{parentName:"li"},"flyer[caller].miles.count() = 0")," stands true afterwards")),(0,l.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("p",{parentName:"div"},"Note that the above instruction is equivalent to ",(0,l.kt)("a",{parentName:"p",href:"/docs/reference/instructions/asset#aremove_ifp"},(0,l.kt)("inlineCode",{parentName:"a"},"remove_if(true)"))," instruction because a partition ",(0,l.kt)("em",{parentName:"p"},"synchronizes")," the existence of the reference towards the asset."))),(0,l.kt)("h4",{id:"aggregate"},"Aggregate"),(0,l.kt)("p",null,"The ",(0,l.kt)("inlineCode",{parentName:"p"},"remove_all")," instruction on an ",(0,l.kt)("a",{parentName:"p",href:"/docs/reference/types#aggregate%3CA%3E"},"aggregate")," field removes all references in the aggregate fields."),(0,l.kt)("p",null,"For example, the following instruction removes all references from driver ",(0,l.kt)("inlineCode",{parentName:"p"},"caller")," to ",(0,l.kt)("a",{parentName:"p",href:"/docs/reference/instructions/asset#aggregate"},(0,l.kt)("inlineCode",{parentName:"a"},"vehicle"))," assets:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-archetype"},"driver[caller].drives.remove_all()\n")),(0,l.kt)("p",null,"The only effect of above instruction is to empty the list of vehicles driven by driver ",(0,l.kt)("inlineCode",{parentName:"p"},"caller")," so that ",(0,l.kt)("inlineCode",{parentName:"p"},"driver[caller].drives.count() = 0")," stands true afterwards. The collection of vehicles is left unchanged."))}N.isMDXComponent=!0;var y=["components"],w={toc:[{value:"Partition",id:"partition",level:4},{value:"Aggregate",id:"aggregate",level:4},{value:"Asset view",id:"asset-view",level:4}]};function C(e){var t=e.components,a=(0,i.Z)(e,y);return(0,l.kt)("wrapper",(0,n.Z)({},w,a,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("p",null,"Removes asset with key ",(0,l.kt)("inlineCode",{parentName:"p"},"k")," from collection ",(0,l.kt)("inlineCode",{parentName:"p"},"A"),"."),(0,l.kt)("p",null,"For example, consider the following declaration:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-archetype"},"asset ledger {\n  owner  : address;\n  amount : nat;\n}\n")),(0,l.kt)("p",null,"The following instruction removes entry for address ",(0,l.kt)("inlineCode",{parentName:"p"},"tz1VSUr8wwNhLAzempoch5d6hLRiTh8Cjcjb"),":"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-archetype"},"ledger.remove(tz1VSUr8wwNhLAzempoch5d6hLRiTh8Cjcjb);\n")),(0,l.kt)("p",null,"Note that it does ",(0,l.kt)("em",{parentName:"p"},"not")," fail when the asset is not in the collection."),(0,l.kt)("h4",{id:"partition"},"Partition"),(0,l.kt)("p",null,"A partitioned asset may be removed only through the ",(0,l.kt)("a",{parentName:"p",href:"/docs/reference/types#partition%3CA%3E"},"partition")," field of the partitioning asset, that is that it is not possible to straighforwardly add an asset in a partitioned asset."),(0,l.kt)("p",null,"For example, consider the following declarations where a ",(0,l.kt)("inlineCode",{parentName:"p"},"mile")," belongs to one and only one ",(0,l.kt)("inlineCode",{parentName:"p"},"flyer")," through the ",(0,l.kt)("inlineCode",{parentName:"p"},"miles")," partition field:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-archetype"},"asset mile identified by k {\n  k          : string;\n  expiration : date\n}\n\nasset flyer identified by a {\n  a     : address;\n  miles : partition<mile>\n}\n")),(0,l.kt)("p",null,"The following instruction removes the mile asset with key ",(0,l.kt)("inlineCode",{parentName:"p"},'"#1"')," owned by flyer ",(0,l.kt)("inlineCode",{parentName:"p"},"a"),":"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-archetype"},'flyer[a].miles.remove("#1")\n')),(0,l.kt)("p",null,"Note that the effect of above instruction is to:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"remove the asset in the partitioned asset (so that ",(0,l.kt)("inlineCode",{parentName:"li"},'mile.contains("#1")')," returns ",(0,l.kt)("inlineCode",{parentName:"li"},"false"),")"),(0,l.kt)("li",{parentName:"ul"},"remove the reference ",(0,l.kt)("inlineCode",{parentName:"li"},'"#1"')," to the partition field ",(0,l.kt)("inlineCode",{parentName:"li"},"assets")," (so that ",(0,l.kt)("inlineCode",{parentName:"li"},'flyer[a].miles.contains("#1")')," returns ",(0,l.kt)("inlineCode",{parentName:"li"},"false")," )")),(0,l.kt)("p",null,"The following instruction is ",(0,l.kt)("em",{parentName:"p"},"rejected")," by the compiler:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-archetype"},'mile.remove("#1")\n')),(0,l.kt)("p",null,"with the following error:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"Cannot access asset collection: asset partitioned is partitionned by field(s) (miles).\n")),(0,l.kt)("h4",{id:"aggregate"},"Aggregate"),(0,l.kt)("p",null,"The ",(0,l.kt)("inlineCode",{parentName:"p"},"remove")," instruction on an ",(0,l.kt)("a",{parentName:"p",href:"/docs/reference/types#aggregate%3CA%3E"},"aggregate")," field removes the reference to the asset."),(0,l.kt)("p",null,"For example, consider the following declarations where a ",(0,l.kt)("inlineCode",{parentName:"p"},"vehicle")," may be referenced by several ",(0,l.kt)("inlineCode",{parentName:"p"},"driver")," assets through the ",(0,l.kt)("inlineCode",{parentName:"p"},"drives")," aggregate field:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-archetype"},"asset vehicle identified by vin {\n  vin     : string;\n  nbdoors : nat\n}\n\nasset driver identified by id {\n  id     : address;\n  drives : aggregate<vehicle>\n}\n")),(0,l.kt)("p",null,"The following instruction removes the reference to vehicle ",(0,l.kt)("inlineCode",{parentName:"p"},'"1G1AF1F57A7192174"'),":"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-archetype"},'driver[caller].drives.remove("1G1AF1F57A7192174");\n')),(0,l.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("p",{parentName:"div"},"The instruction above does not fail if vehicle ",(0,l.kt)("inlineCode",{parentName:"p"},'"1G1AF1F57A7192174"')," is not referenced by ",(0,l.kt)("inlineCode",{parentName:"p"},"drives"),"."))),(0,l.kt)("h4",{id:"asset-view"},"Asset view"),(0,l.kt)("p",null,"As a ",(0,l.kt)("em",{parentName:"p"},"read-only")," set of asset references, an ",(0,l.kt)("a",{parentName:"p",href:"/docs/reference/types#asset_view%3CA%3E"},"asset_view")," does ",(0,l.kt)("em",{parentName:"p"},"not")," provide the ",(0,l.kt)("inlineCode",{parentName:"p"},"remove")," instruction."))}C.isMDXComponent=!0;var b=["components"],E={toc:[]};function x(e){var t=e.components,a=(0,i.Z)(e,b);return(0,l.kt)("wrapper",(0,n.Z)({},E,a,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("p",null,"Removes all assets referenced by ",(0,l.kt)("a",{parentName:"p",href:"/docs/reference/types#asset_view%3CA%3E"},(0,l.kt)("inlineCode",{parentName:"a"},"asset_view"))," ",(0,l.kt)("inlineCode",{parentName:"p"},"A"),"."),(0,l.kt)("p",null,"For example, the following instruction removes all ",(0,l.kt)("a",{parentName:"p",href:"/docs/reference/instructions/asset#aupdatek--u-"},"cars")," assets owned by ",(0,l.kt)("inlineCode",{parentName:"p"},"caller")," :"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-archetype"},"car.select(the.owner = caller).clear()\n")),(0,l.kt)("p",null,"This is equivalent to:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-archetype"},"const v = car.select(the.owner = caller);\nfor k in v do\n  car.remove(k)\ndone\n")))}x.isMDXComponent=!0;var A=["components"],_={toc:[]};function Z(e){var t=e.components,a=(0,i.Z)(e,A);return(0,l.kt)("wrapper",(0,n.Z)({},_,a,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("p",null,"Removes assets ",(0,l.kt)("em",{parentName:"p"},"referenced by")," an ",(0,l.kt)("a",{parentName:"p",href:"/docs/asset#aggregate"},"aggregate")," or ",(0,l.kt)("a",{parentName:"p",href:"/docs/asset#partition"},"partition")," field ",(0,l.kt)("inlineCode",{parentName:"p"},"A")," and that verify predicate ",(0,l.kt)("inlineCode",{parentName:"p"},"p"),"."),(0,l.kt)("p",null,"For example, consider the following declarations:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-archetype"},"asset vehicle identified by vin {\n  vin      : string;\n  nb_doors : nat\n}\n\nasset driver identified by id {\n  id     : address;\n  drives : aggregate<vehicle>\n}\n")),(0,l.kt)("p",null,"For example the following instruction removes all vehicles driven by driver ",(0,l.kt)("inlineCode",{parentName:"p"},"caller")," with ",(0,l.kt)("inlineCode",{parentName:"p"},"nb_doors")," equal to ",(0,l.kt)("inlineCode",{parentName:"p"},"0"),":"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-archetype"},"driver[caller].drives.remove_if(the.nb_doors = 0)\n")),(0,l.kt)("p",null,"The ",(0,l.kt)("inlineCode",{parentName:"p"},"the")," keyword refers to the asset being evaluated; all asset fields are available in predicates."),(0,l.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"caution")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("p",{parentName:"div"},"When used on a ",(0,l.kt)("a",{parentName:"p",href:"/docs/asset#partition"},"partition")," field, references in the parititon field ",(0,l.kt)("em",{parentName:"p"},"are also removed")," for consistency reason, as the partition ensures that any reference points to an existing asset."))))}Z.isMDXComponent=!0;var T=["components"],P={toc:[{value:"Basic containers",id:"basic-containers",level:4},{value:"Aggregate and partition",id:"aggregate-and-partition",level:4},{value:"Asset view",id:"asset-view",level:4}]};function B(e){var t=e.components,a=(0,i.Z)(e,T);return(0,l.kt)("wrapper",(0,n.Z)({},P,a,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("p",null,"Updates one or several fields of asset with key ",(0,l.kt)("inlineCode",{parentName:"p"},"k")," in collection ",(0,l.kt)("inlineCode",{parentName:"p"},"A"),", and ",(0,l.kt)("em",{parentName:"p"},"fails")," when ",(0,l.kt)("inlineCode",{parentName:"p"},"k"),"is not found in ",(0,l.kt)("inlineCode",{parentName:"p"},"A"),"."),(0,l.kt)("p",null,"For example, consider the ",(0,l.kt)("inlineCode",{parentName:"p"},"car")," asset:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-archetype"},"asset car {\n  vin        : string;\n  nb_doors   : nat;\n  nb_repairs : nat;\n  owner      : address;\n}\n")),(0,l.kt)("p",null,"The following instruction increments ",(0,l.kt)("inlineCode",{parentName:"p"},"nbrepairs")," and assigns ",(0,l.kt)("inlineCode",{parentName:"p"},"owner"),":"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-archetype"},'car.update("1G1AF1F57A7192174", {\n  nb_repairs += 1;\n  owner     := tz1Lc2qBKEWCBeDU8npG6zCeCqpmaegRi6Jg\n})\n')),(0,l.kt)("p",null,'An "',(0,l.kt)("em",{parentName:"p"},"inlined"),'" syntax for ',(0,l.kt)("em",{parentName:"p"},"update")," is available; for example the ",(0,l.kt)("em",{parentName:"p"},"update")," instruction above is equivalent to:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-archetype"},'var k = "1G1AF1F57A7192174";\ncar[k].nb_repairs += 1;\ncar[k].owner := tz1Lc2qBKEWCBeDU8npG6zCeCqpmaegRi6Jg;\n')),(0,l.kt)("h4",{id:"basic-containers"},"Basic containers"),(0,l.kt)("p",null,(0,l.kt)("a",{parentName:"p",href:"/docs/language-basics/container#map"},"Maps")," and ",(0,l.kt)("a",{parentName:"p",href:"/docs/language-basics/container#set"},"sets")," fieds may be updated with ",(0,l.kt)("inlineCode",{parentName:"p"},":=")," ",(0,l.kt)("inlineCode",{parentName:"p"},"+=")," and ",(0,l.kt)("inlineCode",{parentName:"p"},"-=")," update instructions."),(0,l.kt)("p",null,"For example, consider the following asset declaration:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-archetype"},"asset my_asset {\n  id : nat;\n  m  : map<string, bytes>;\n} initialized with {\n  {0; []}\n}\n")),(0,l.kt)("p",null,"The following associates 3 values to ",(0,l.kt)("inlineCode",{parentName:"p"},'"k"')," ",(0,l.kt)("inlineCode",{parentName:"p"},'"l"')," and ",(0,l.kt)("inlineCode",{parentName:"p"},'"m"')," keys in map field ",(0,l.kt)("inlineCode",{parentName:"p"},"m")," of asset ",(0,l.kt)("inlineCode",{parentName:"p"},"0"),":"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-archetype"},'my_asset.update(0, { m += [("k", 0x00); ("l", 0x01); ("m", 0x02)] });\n')),(0,l.kt)("p",null,"The ",(0,l.kt)("inlineCode",{parentName:"p"},"+=")," instruction overwrites any previous association."),(0,l.kt)("p",null,"The following removes key ",(0,l.kt)("inlineCode",{parentName:"p"},'"k"')," in ",(0,l.kt)("inlineCode",{parentName:"p"},"m")," of asset ",(0,l.kt)("inlineCode",{parentName:"p"},"0"),":"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-archetype"},'my_asset.add_update(0, { m -= ["k"] });\n')),(0,l.kt)("h4",{id:"aggregate-and-partition"},"Aggregate and partition"),(0,l.kt)("p",null,"A partition or aggregate field does ",(0,l.kt)("em",{parentName:"p"},"not")," provide the ",(0,l.kt)("inlineCode",{parentName:"p"},"update")," instruction, as it does not impact the reference to the asset. The ",(0,l.kt)("inlineCode",{parentName:"p"},"update")," instruction is done straightorwardly on the (partitioned or aggregated) asset collection."),(0,l.kt)("h4",{id:"asset-view"},"Asset view"),(0,l.kt)("p",null,"As a ",(0,l.kt)("em",{parentName:"p"},"read-only")," set of asset references, an ",(0,l.kt)("a",{parentName:"p",href:"/docs/reference/types#asset_view%3CA%3E"},"asset_view")," does ",(0,l.kt)("em",{parentName:"p"},"not")," provide the ",(0,l.kt)("inlineCode",{parentName:"p"},"update")," instruction."))}B.isMDXComponent=!0;var M=["components"],z={toc:[]};function F(e){var t=e.components,a=(0,i.Z)(e,M);return(0,l.kt)("wrapper",(0,n.Z)({},z,a,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("p",null,"Updates one or several fields of all assets of a collection, ",(0,l.kt)("a",{parentName:"p",href:"/docs/asset#aggregate"},"aggregate"),", ",(0,l.kt)("a",{parentName:"p",href:"/docs/asset#partition"},"partition")," or ",(0,l.kt)("a",{parentName:"p",href:"/docs/reference/types#asset_view%3CA%3E"},"asset_view")," ",(0,l.kt)("inlineCode",{parentName:"p"},"A"),"."),(0,l.kt)("p",null,"For example, the following instruction increments by ",(0,l.kt)("inlineCode",{parentName:"p"},"1")," the ",(0,l.kt)("inlineCode",{parentName:"p"},"nb_repairs")," field of all ",(0,l.kt)("a",{parentName:"p",href:"/docs/reference/instructions/asset#aupdatek--u-"},"cars")," owned by ",(0,l.kt)("inlineCode",{parentName:"p"},"caller"),":"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-archetype"},"car.select(the.owner = caller).update_all({ nb_repairs += 1 })\n")),(0,l.kt)("p",null,"This is equivalent to:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-archetype"},"const v = car.select(the.owner = caller);\nfor k in v do\n  car.update(k, { nb_repairs += 1 })\ndone\n")))}F.isMDXComponent=!0;var L=["components"],R={toc:[]};function D(e){var t=e.components,a=(0,i.Z)(e,L);return(0,l.kt)("wrapper",(0,n.Z)({},R,a,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("p",null,"Puts or removes an asset in collection ",(0,l.kt)("inlineCode",{parentName:"p"},"A")," depending on value of option value o:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"when ",(0,l.kt)("inlineCode",{parentName:"li"},"o")," is ",(0,l.kt)("inlineCode",{parentName:"li"},"some(v)"),", then asset ",(0,l.kt)("inlineCode",{parentName:"li"},"make_asset(k, v)")," is put in collection"),(0,l.kt)("li",{parentName:"ul"},"when ",(0,l.kt)("inlineCode",{parentName:"li"},"o")," is ",(0,l.kt)("inlineCode",{parentName:"li"},"none"),", then asset with key ",(0,l.kt)("inlineCode",{parentName:"li"},"k")," is removed from collection")))}D.isMDXComponent=!0;var S={add:{desc:r.createElement(p,null),sig:"A.add(a)",appliesto:["asset","asset to big_map","asset to iterable_big_map","aggregate","partition"],parameters:[{type:"asset literal",withLink:!1,alias:"a",desc:r.createElement("div",null,"Asset literal to be added, formed of the value of asset fields.")}],fails:[{keyword:'(Pair "A" "KEY_EXISTS")',desc:r.createElement("div",null,"when an asset with same key is already in the collection. (",r.createElement("code",null,'"A"')," being the name of the asset collection).")}],related:[{keyword:"Asset",link:"/docs/asset",code:!1},{keyword:"put",link:"/docs/reference/instructions/containers#aputa"},{keyword:"update",link:"/docs/reference/instructions/containers/#aupdatek--u-"},{keyword:"remove",link:"/docs/reference/instructions/containers#aremovek"}]},put:{desc:r.createElement(u,null),sig:"A.put(a)",appliesto:["asset","asset to big_map","asset to iterable_big_map"],parameters:[{type:"asset literal",withLink:!1,alias:"a",desc:r.createElement("div",null,"Asset literal to be added.")}],fails:[],related:[{keyword:"Asset",link:"/docs/asset",code:!1},{keyword:"add",link:"/docs/reference/instructions/asset#aadda"},{keyword:"update",link:"/docs/reference/instructions/asset/#aupdatek--u-"},{keyword:"remove",link:"/docs/reference/instructions/asset/#aremovek"}]},update:{desc:r.createElement(B,null),appliesto:["asset","asset to big_map","asset to iterable_big_map"],parameters:[{type:"asset_key<A>",alias:"k",desc:r.createElement("div",null,"Key of the asset to update fields of.")},{type:"update literal",withLink:!1,alias:"u",desc:r.createElement("div",null,"Curly bracketed list of fields' assignment instructions (separated by ",r.createElement("code",null,";"),"); these instructions are presented in the ",r.createElement(o.Z,{to:"/docs/reference/instructions/assignment"},"assignment")," section (",r.createElement("code",null,":="),"\xa0",r.createElement("code",null,"+="),"\xa0",r.createElement("code",null,"-="),"\xa0",r.createElement("code",null,"*="),"\xa0",r.createElement("code",null,"/="),"\xa0",r.createElement("code",null,"&="),"\xa0",r.createElement("code",null,"|="),").")}],fails:[{keyword:'(Pair "A" "ASSET_NOT_FOUND")',desc:r.createElement("div",null,"when no asset with key ",r.createElement("code",null,"k")," is in the collection (",r.createElement("code",null,'"A"')," being the name of the asset collection).")}],related:[{keyword:"Asset",link:"/docs/asset"},{keyword:"Assignment",link:"/docs/reference/instructions/asset#assignment"},{keyword:"add_update",link:"/docs/reference/instructions/asset#aadd_updatek--u-"}]},update_all:{desc:r.createElement(F,null),appliesto:["asset","asset to iterable_big_map","partition","aggregate","asset_view"],parameters:[{type:"update literal",withLink:!1,alias:"u",desc:r.createElement("div",null,"Curly bracketed list of fields' assignment instructions (separated by ",r.createElement("code",null,";"),"); these instructions are presented in the ",r.createElement(o.Z,{to:"/docs/reference/instructions/assignment"},"assignment")," section (",r.createElement("code",null,":="),"\xa0",r.createElement("code",null,"+="),"\xa0",r.createElement("code",null,"-="),"\xa0",r.createElement("code",null,"*="),"\xa0",r.createElement("code",null,"/="),"\xa0",r.createElement("code",null,"&="),"\xa0",r.createElement("code",null,"|="),").")}],related:[{keyword:"Asset",link:"/docs/asset"},{keyword:"Assignment",link:"/docs/reference/instructions/asset#assignment"},{keyword:"update",link:"/docs/reference/instructions/asset#aupdatek--u-"}]},add_update:{desc:r.createElement(g,null),appliesto:["asset","asset to big_map","asset to iterable_big_map","partition"],parameters:[{type:"asset_key<A>",alias:"k",desc:r.createElement("div",null,"Key of the asset to update fields of.")},{type:"update literal",withLink:!1,alias:"u",desc:r.createElement("div",null,"Curly bracketed list of fields' assignment instructions (separated by ",r.createElement("code",null,";"),"); these instructions are presented in the ",r.createElement(o.Z,{to:"/docs/reference/instructions/assignment"},"assignment")," section (",r.createElement("code",null,":="),"\xa0",r.createElement("code",null,"+="),"\xa0",r.createElement("code",null,"-="),"\xa0",r.createElement("code",null,"*="),"\xa0",r.createElement("code",null,"/="),"\xa0",r.createElement("code",null,"&="),"\xa0",r.createElement("code",null,"|="),").",r.createElement("br",null),r.createElement("br",null),"Note that these update instructions are only available for fields with a specified default value.")}],related:[{keyword:"Asset",link:"/docs/asset"},{keyword:"Assignment",link:"/docs/reference/instructions/asset#assignment"},{keyword:"add",link:"/docs/reference/instructions/asset#aadda"},{keyword:"update",link:"/docs/reference/instructions/asset#aupdatek--u-"}]},remove:{desc:r.createElement(C,null),appliesto:["asset","asset to big_map","asset to iterable_big_map","aggregate","partition"],parameters:[{type:"asset_key<A>",alias:"k",desc:r.createElement("div",null,"Key of the asset to remove.")}],related:[{keyword:"Asset",link:"/docs/asset"},{keyword:"add",link:"/docs/reference/instructions/asset#aadda"}]},put_remove:{desc:r.createElement(D,null),appliesto:["asset","asset to big_map","asset to iterable_big_map"],parameters:[{type:"asset_key<A>",alias:"k",desc:r.createElement("div",null,"Key of the asset to add or remove.")},{type:"option<asset_value<A>>",alias:"o",withLink:!1,desc:r.createElement("div",null,"Option of asset value to add or remove.")}],related:[{keyword:"Asset",link:"/docs/asset"},{keyword:"put",link:"/docs/reference/instructions/asset#aputa"},{keyword:"remove",link:"/docs/reference/instructions/asset#aremovek"},{keyword:"make_asset",link:"/docs/reference/expressions/builtins#make_asset(k%20:%20asset_key<A>,%20v%20:%20asset_value<A>)"}]},remove_if:{desc:r.createElement(Z,null),appliesto:["aggregate","partition"],parameters:[{type:"predicate",alias:"p",withLink:!1,desc:r.createElement("div",null,"Predicate.")}],related:[{keyword:"Asset",link:"/docs/asset"},{keyword:"remove",link:"/docs/reference/instructions/asset#aremovek"},{keyword:"remove_all",link:"/docs/reference/instructions/asset#aremove_all"}]},remove_all:{desc:r.createElement(N,null),appliesto:["asset","asset to iterable_big_map","aggregate","partition"],parameters:[],related:[{keyword:"Asset",link:"/docs/asset"},{keyword:"remove",link:"/docs/reference/instructions/asset#aremovek"},{keyword:"remove_if",link:"/docs/reference/instructions/asset#aremove_ifp"},{keyword:"select",link:"/docs/reference/expressions/asset#aselectp"}]},clear:{desc:r.createElement(x,null),appliesto:["asset_view"],parameters:[],related:[{keyword:"Asset",link:"/docs/asset"},{keyword:"remove",link:"/docs/reference/instructions/asset#remove"},{keyword:"remove_all",link:"/docs/reference/instructions/asset#remove_all"}]}},I=a(432),X=["components"],q={sidebar_position:6},W="Asset",V={unversionedId:"reference/instructions/asset",id:"reference/instructions/asset",title:"Asset",description:"A.add(a)",source:"@site/docs/reference/instructions/asset.md",sourceDirName:"reference/instructions",slug:"/reference/instructions/asset",permalink:"/docs/reference/instructions/asset",draft:!1,editUrl:"https://github.com/completium/archetype-docs/blob/main/docs/reference/instructions/asset.md",tags:[],version:"current",sidebarPosition:6,frontMatter:{sidebar_position:6},sidebar:"docs",previous:{title:"Basic containers",permalink:"/docs/reference/instructions/containers"},next:{title:"Operation",permalink:"/docs/reference/instructions/operation"}},G={},j=[{value:"<code>A.add(a)</code>",id:"aadda",level:3},{value:"<code>A.put(a)</code>",id:"aputa",level:3},{value:"<code>A.update(k, { u })</code>",id:"aupdatek--u-",level:3},{value:"<code>A.update_all({ u })</code>",id:"aupdate_all-u-",level:3},{value:"<code>A.add_update(k, { u })</code>",id:"aadd_updatek--u-",level:3},{value:"<code>A.remove(k)</code>",id:"aremovek",level:3},{value:"<code>A.put_remove(k, o)</code>",id:"aput_removek-o",level:3},{value:"<code>A.remove_if(p)</code>",id:"aremove_ifp",level:3},{value:"<code>A.remove_all()</code>",id:"aremove_all",level:3},{value:"<code>A.clear()</code>",id:"aclear",level:3}],H={toc:j};function U(e){var t=e.components,a=(0,i.Z)(e,X);return(0,l.kt)("wrapper",(0,n.Z)({},H,a,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("h1",{id:"asset"},"Asset"),(0,l.kt)("h3",{id:"aadda"},(0,l.kt)("inlineCode",{parentName:"h3"},"A.add(a)")),(0,l.kt)(I.Z,{data:S.add,mdxType:"Builtin"}),(0,l.kt)("h3",{id:"aputa"},(0,l.kt)("inlineCode",{parentName:"h3"},"A.put(a)")),(0,l.kt)(I.Z,{data:S.put,mdxType:"Builtin"}),(0,l.kt)("h3",{id:"aupdatek--u-"},(0,l.kt)("inlineCode",{parentName:"h3"},"A.update(k, { u })")),(0,l.kt)(I.Z,{data:S.update,mdxType:"Builtin"}),(0,l.kt)("h3",{id:"aupdate_all-u-"},(0,l.kt)("inlineCode",{parentName:"h3"},"A.update_all({ u })")),(0,l.kt)(I.Z,{data:S.update_all,mdxType:"Builtin"}),(0,l.kt)("h3",{id:"aadd_updatek--u-"},(0,l.kt)("inlineCode",{parentName:"h3"},"A.add_update(k, { u })")),(0,l.kt)(I.Z,{data:S.add_update,mdxType:"Builtin"}),(0,l.kt)("h3",{id:"aremovek"},(0,l.kt)("inlineCode",{parentName:"h3"},"A.remove(k)")),(0,l.kt)(I.Z,{data:S.remove,mdxType:"Builtin"}),(0,l.kt)("h3",{id:"aput_removek-o"},(0,l.kt)("inlineCode",{parentName:"h3"},"A.put_remove(k, o)")),(0,l.kt)(I.Z,{data:S.put_remove,mdxType:"Builtin"}),(0,l.kt)("h3",{id:"aremove_ifp"},(0,l.kt)("inlineCode",{parentName:"h3"},"A.remove_if(p)")),(0,l.kt)(I.Z,{data:S.remove_if,mdxType:"Builtin"}),(0,l.kt)("h3",{id:"aremove_all"},(0,l.kt)("inlineCode",{parentName:"h3"},"A.remove_all()")),(0,l.kt)(I.Z,{data:S.remove_all,mdxType:"Builtin"}),(0,l.kt)("h3",{id:"aclear"},(0,l.kt)("inlineCode",{parentName:"h3"},"A.clear()")),(0,l.kt)(I.Z,{data:S.clear,mdxType:"Builtin"}))}U.isMDXComponent=!0},2321:function(e,t){t.Z={divider:"divider_LuCZ",gradient:"gradient_kJ7D"}}}]);