"use strict";(self.webpackChunkarchetype_docs=self.webpackChunkarchetype_docs||[]).push([[9885],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>m});var a=n(7294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var s=a.createContext({}),c=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},p=function(e){var t=c(e.components);return a.createElement(s.Provider,{value:t},e.children)},u="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},h=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,o=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),u=c(n),h=i,m=u["".concat(s,".").concat(h)]||u[h]||d[h]||o;return n?a.createElement(m,r(r({ref:t},p),{},{components:n})):a.createElement(m,r({ref:t},p))}));function m(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var o=n.length,r=new Array(o);r[0]=h;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[u]="string"==typeof e?e:i,r[1]=l;for(var c=2;c<o;c++)r[c]=n[c];return a.createElement.apply(null,r)}return a.createElement.apply(null,n)}h.displayName="MDXCreateElement"},1069:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>r,default:()=>u,frontMatter:()=>o,metadata:()=>l,toc:()=>c});var a=n(7462),i=(n(7294),n(3905));const o={sidebar_position:6,sidebar_label:"Debugging"},r="Debugging",l={unversionedId:"tests/debug",id:"tests/debug",title:"Debugging",description:"The Archetype extension for VSCode provides  debugging capabilities for developers working with Archetype. This tool streamlines the debugging process, making it easier to identify and resolve issues in an Archetype contract. It often becomes indispensable for swift issue identification and resolution.",source:"@site/docs/tests/debug.md",sourceDirName:"tests",slug:"/tests/debug",permalink:"/docs/tests/debug",draft:!1,editUrl:"https://github.com/completium/archetype-docs/blob/main/docs/tests/debug.md",tags:[],version:"current",sidebarPosition:6,frontMatter:{sidebar_position:6,sidebar_label:"Debugging"},sidebar:"tests",previous:{title:"Experiment",permalink:"/docs/tests/apis/experiment"}},s={},c=[{value:"Requirements",id:"requirements",level:2},{value:"Octez client",id:"octez-client",level:3},{value:"Octez codec",id:"octez-codec",level:3},{value:"Getting Started",id:"getting-started",level:2},{value:"Start a Debug Session",id:"start-a-debug-session",level:3},{value:"Entrypoint Selections",id:"entrypoint-selections",level:3},{value:"Execute Code",id:"execute-code",level:3},{value:"Features",id:"features",level:2},{value:"Local Variables",id:"local-variables",level:3},{value:"Storage Elements",id:"storage-elements",level:3},{value:"Operations",id:"operations",level:3},{value:"Gas Information",id:"gas-information",level:3},{value:"<code>launch.json</code>",id:"launchjson",level:2},{value:"Contract context",id:"contract-context",level:3},{value:"Default inputs",id:"default-inputs",level:3},{value:"Default storage",id:"default-storage",level:3},{value:"Default constant parameter",id:"default-constant-parameter",level:3},{value:"Example",id:"example",level:3}],p={toc:c};function u(e){let{components:t,...n}=e;return(0,i.kt)("wrapper",(0,a.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"debugging"},"Debugging"),(0,i.kt)("p",null,"The ",(0,i.kt)("a",{parentName:"p",href:"https://marketplace.visualstudio.com/items?itemName=edukera.archetype"},"Archetype extension")," for VSCode provides  debugging capabilities for developers working with Archetype. This tool streamlines the debugging process, making it easier to identify and resolve issues in an Archetype contract. It often becomes indispensable for swift issue identification and resolution."),(0,i.kt)("h2",{id:"requirements"},"Requirements"),(0,i.kt)("p",null,"Ensure you have the necessary utilities installed for a seamless debugging experience."),(0,i.kt)("h3",{id:"octez-client"},"Octez client"),(0,i.kt)("p",null,"Rather than relying on an adhoc Archetype interpreter, the debugging process integrates with the official ",(0,i.kt)("a",{parentName:"p",href:"https://tezos.gitlab.io/introduction/howtoget.html"},"octez-client")," binary. This ensures tracing the execution of the compiled Michelson code, adding an extra layer of ",(0,i.kt)("em",{parentName:"p"},"safety")," to the process."),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"Installation"),": Follow the guidelines on the official site to install the ",(0,i.kt)("inlineCode",{parentName:"p"},"octez-client"),".")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"Configuration"),": Post-installation, configure the path to the ",(0,i.kt)("inlineCode",{parentName:"p"},"octez-client")," binary within the extension parameters. The default path is set to ",(0,i.kt)("inlineCode",{parentName:"p"},'"octez-client"'),"."))),(0,i.kt)("h3",{id:"octez-codec"},"Octez codec"),(0,i.kt)("p",null,"Decode generated operations with precision using the ",(0,i.kt)("a",{parentName:"p",href:"https://tezos.gitlab.io/introduction/howtouse.html?highlight=octez%20codec"},"octez-codec")," utility. While it's an ",(0,i.kt)("em",{parentName:"p"},"optional")," tool, having it installed will offer more granular insights into the operations."),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"Installation"),": Obtain the ",(0,i.kt)("inlineCode",{parentName:"p"},"octez-codec")," binary as outlined in the provided link.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"Configuration"),": Once installed, specify the path to the ",(0,i.kt)("inlineCode",{parentName:"p"},"octez-codec")," binary in the extension settings. It defaults to ",(0,i.kt)("inlineCode",{parentName:"p"},'"octez-codec"'),"."))),(0,i.kt)("h2",{id:"getting-started"},"Getting Started"),(0,i.kt)("p",null,"Follow this step-by-step guide to initiate a debug session with ease."),(0,i.kt)("h3",{id:"start-a-debug-session"},"Start a Debug Session"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Open Archetype contract in VSCode."),(0,i.kt)("li",{parentName:"ol"},"Access the debug view by clicking on the bug icon on the sidebar."),(0,i.kt)("li",{parentName:"ol"},'Click on the "Create a launch.json file" (the first time only); this creates locally and displays the default ',(0,i.kt)("inlineCode",{parentName:"li"},".vscode/launch.json")," file; focus back on the Archetype contract."),(0,i.kt)("li",{parentName:"ol"},'Click on the green arrow on the left of between "RUN AND DEBUG" and "Archetype : debug".')),(0,i.kt)("h3",{id:"entrypoint-selections"},"Entrypoint Selections"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"If the contract has several entrypoints, select the entrypoint to debug in the drop menu."),(0,i.kt)("li",{parentName:"ol"},"If the entrypoint has parameters, set the value of each parameter."),(0,i.kt)("li",{parentName:"ol"},"If the contract has storage elements, set the value of each element.")),(0,i.kt)("p",null,"The expected format for parameters and storage elements is ",(0,i.kt)("strong",{parentName:"p"},"Michelson"),"."),(0,i.kt)("h3",{id:"execute-code"},"Execute Code"),(0,i.kt)("p",null,"The process pauses at the beginning of the entrypoint execution:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Utilize the debug controls for 'Step Over', 'Step back', or 'Stop' as per your needs."),(0,i.kt)("li",{parentName:"ol"},"Observe the changes in the storage, local variables, and operations.")),(0,i.kt)("p",null,"Note that you can also hover storage and local variables to display values ",(0,i.kt)("em",{parentName:"p"},"in situ"),"."),(0,i.kt)("p",null,"The process stops when the end of entrypoint execution is reached."),(0,i.kt)("h2",{id:"features"},"Features"),(0,i.kt)("p",null,"Dive deep into the specifics:"),(0,i.kt)("h3",{id:"local-variables"},"Local Variables"),(0,i.kt)("p",null,"Examine the values of local variables during execution, allowing for a comprehensive understanding of the logic flow."),(0,i.kt)("h3",{id:"storage-elements"},"Storage Elements"),(0,i.kt)("p",null,"Track changes and values within your contract's storage, offering insights into the state persistence."),(0,i.kt)("h3",{id:"operations"},"Operations"),(0,i.kt)("p",null,"Witness in real-time the generated operations and, with the help of the ",(0,i.kt)("inlineCode",{parentName:"p"},"octez-codec"),", get detailed interpretations of each operation."),(0,i.kt)("h3",{id:"gas-information"},"Gas Information"),(0,i.kt)("p",null,"Consumed gas is displayed as code decoration on every instruction. The delta information tells the gas of the instruction."),(0,i.kt)("h2",{id:"launchjson"},(0,i.kt)("inlineCode",{parentName:"h2"},"launch.json")),(0,i.kt)("p",null,"Contract developpement often requires a high number of test/debug iterations. Entering the storage and input values at each iteration may be tedious. In order to speed up the process, it is possible to set the default values in the ",(0,i.kt)("inlineCode",{parentName:"p"},"launch.json")," file."),(0,i.kt)("h3",{id:"contract-context"},"Contract context"),(0,i.kt)("p",null,"Entrypoint and contract execution context may be set in the ",(0,i.kt)("inlineCode",{parentName:"p"},"env")," section of the ",(0,i.kt)("inlineCode",{parentName:"p"},"launch.json")," file:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"/docs/reference/expressions/constants#caller"},(0,i.kt)("inlineCode",{parentName:"a"},"caller"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"/docs/reference/expressions/constants#transferred"},(0,i.kt)("inlineCode",{parentName:"a"},"transferred"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"/docs/reference/expressions/constants#balance"},(0,i.kt)("inlineCode",{parentName:"a"},"balance"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"/docs/reference/expressions/constants#level"},(0,i.kt)("inlineCode",{parentName:"a"},"level"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"/docs/reference/expressions/constants#now"},(0,i.kt)("inlineCode",{parentName:"a"},"now"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"/docs/reference/expressions/constants#source"},(0,i.kt)("inlineCode",{parentName:"a"},"source")))),(0,i.kt)("p",null,"Below is the default context values:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'"env": {\n  "now": "2023-10-27 09:25:11",\n  "level": "10000",\n  "caller": "tz1VSUr8wwNhLAzempoch5d6hLRiTh8Cjcjb",\n  "source": "tz1VSUr8wwNhLAzempoch5d6hLRiTh8Cjcjb",\n  "transferred": "0",\n  "balance": "1000000"\n}\n')),(0,i.kt)("h3",{id:"default-inputs"},"Default inputs"),(0,i.kt)("p",null,"It is possible to specify default input values in the ",(0,i.kt)("inlineCode",{parentName:"p"},"inputs")," section in the ",(0,i.kt)("inlineCode",{parentName:"p"},"env")," section. For example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'"env": {\n  "inputs": {\n    "spender": "tz1VSUr8wwNhLAzempoch5d6hLRiTh8Cjcjb",\n    "from": "tz1VSUr8wwNhLAzempoch5d6hLRiTh8Cjcjb",\n    "to": "tz1aSkwEot3L2kmUvcoxzjMomb9mvBNuzFK6",\n    "value": "50\n  }\n}\n')),(0,i.kt)("h3",{id:"default-storage"},"Default storage"),(0,i.kt)("p",null,"It is possible to set the default values in the ",(0,i.kt)("inlineCode",{parentName:"p"},"storage")," section in the ",(0,i.kt)("inlineCode",{parentName:"p"},"env")," section of the ",(0,i.kt)("inlineCode",{parentName:"p"},"launch.json")," file. For example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'"storage": {\n  "ledger": "{ Elt \\"tz1VSUr8wwNhLAzempoch5d6hLRiTh8Cjcjb\\" (Pair 1000 {  }) }",\n  "token_metadata": "{ Elt 0 (Pair 0 { Elt \\"\\" 0x00 }) }"\n}\n')),(0,i.kt)("p",null,"It is possible to specify only some specific storage elements."),(0,i.kt)("h3",{id:"default-constant-parameter"},"Default constant parameter"),(0,i.kt)("p",null,"A constant parameter may be specified in the ",(0,i.kt)("inlineCode",{parentName:"p"},"const_params")," section in the ",(0,i.kt)("inlineCode",{parentName:"p"},"env")," section of the ",(0,i.kt)("inlineCode",{parentName:"p"},"launch.json")," file. For example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},' "const_params": {\n  "initial_holder": "tz1VSUr8wwNhLAzempoch5d6hLRiTh8Cjcjb",\n  "total_supply": "1000",\n  "metadata_coin": "0x00"\n},\n')),(0,i.kt)("h3",{id:"example"},"Example"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n  // Use IntelliSense to learn about possible attributes.\n  // Hover to view descriptions of existing attributes.\n  // For more information, visit: https://go.microsoft.com/fwlink/?linkid=830387\n  "version": "0.2.0",\n  "configurations": [\n    {\n      "type": "archetype",\n      "request": "launch",\n      "name": "Archetype : debug",\n      "program": "${file}",\n      "env": {\n        "now": "2023-10-27 09:25:11",\n        "level": "10000",\n        "caller": "tz1VSUr8wwNhLAzempoch5d6hLRiTh8Cjcjb",\n        "source": "tz1VSUr8wwNhLAzempoch5d6hLRiTh8Cjcjb",\n        "transferred": "0",\n        "balance": "1000000",\n        "inputs": {\n          "spender": "tz1VSUr8wwNhLAzempoch5d6hLRiTh8Cjcjb",\n          "from": "tz1VSUr8wwNhLAzempoch5d6hLRiTh8Cjcjb",\n          "to": "tz1aSkwEot3L2kmUvcoxzjMomb9mvBNuzFK6",\n          "value": "500"\n        },\n        "const_params": {\n          "initial_holder": "tz1VSUr8wwNhLAzempoch5d6hLRiTh8Cjcjb",\n          "total_supply": "1000",\n          "metadata_coin": "0x00"\n        },\n        "storage": {\n          "ledger": "{ Elt \\"tz1VSUr8wwNhLAzempoch5d6hLRiTh8Cjcjb\\" (Pair 1000 {  }) }",\n          "token_metadata": "{ Elt 0 (Pair 0 { Elt \\"\\" 0x00 }) }"\n        }\n      }\n    }\n  ]\n}\n')))}u.isMDXComponent=!0}}]);